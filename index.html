<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>起き攻め読み合い補助ツール</title>

<style>
body{
  font-family: sans-serif;
  text-align:center;
  background:#111;
  color:white;
  margin:0;
  padding:20px;
}

h1{
  font-size:20px;
  margin-bottom:15px;
}

button{
  margin:5px;
  padding:10px 14px;
  font-size:14px;
  border:none;
  border-radius:8px;
}

.def-btn{
  background:#333;
  color:white;
}

.result-box{
  margin-top:15px;
  padding:15px;
  border-radius:10px;
}

.best{ background:#0a5; }
.ng{ background:#a22; }
.warn{ background:#aa0; color:black; }

.small{
  font-size:12px;
  opacity:0.7;
}
</style>
</head>

<body>

<h1>起き攻め 読み合い補助（直近10）</h1>

<div id="defenseButtons"></div>

<div id="bestBox" class="result-box best"></div>
<div id="ngBox" class="result-box ng"></div>
<div id="warning" class="result-box warn"></div>

<br>
<button onclick="resetAll()">リセット</button>

<p class="small">直近10回のみ参照します</p>

<script>

const defenses = [
"ガード","投げ抜け","暴れ","無敵技",
"バクステ","ジャンプ","パリィ","ドライブリバーサル"
];

const attacks = ["打撃","投げ","シミー"];

let history = JSON.parse(localStorage.getItem("history")) || [];
let failStreak = 0;

const winMap = {
"ガード": ["投げ"],
"投げ抜け": ["シミー"],
"暴れ": ["打撃","投げ"],
"バクステ": ["打撃"],
"ジャンプ": ["打撃"],
"無敵技": ["シミー"],
"パリィ": ["投げ","シミー"],
"ドライブリバーサル": ["シミー"]
};

const defenseContainer = document.getElementById("defenseButtons");

defenses.forEach(def=>{
  const btn=document.createElement("button");
  btn.innerText=def;
  btn.className="def-btn";
  btn.onclick=()=>{
    addDefense(def);
  };
  defenseContainer.appendChild(btn);
});

function addDefense(def){

  history.push(def);

  if(history.length>10){
    history.shift();
  }

  localStorage.setItem("history", JSON.stringify(history));

  updateRecommendation();
}

function updateRecommendation(){

  if(history.length===0){
    document.getElementById("bestBox").innerHTML="";
    document.getElementById("ngBox").innerHTML="";
    return;
  }

  let tempCounts={};
  defenses.forEach(d=>tempCounts[d]=0);

  history.forEach(h=>tempCounts[h]++);

  let maxDefense = Object.keys(tempCounts).reduce((a,b)=>
    tempCounts[a] > tempCounts[b] ? a : b
  );

  let best = winMap[maxDefense] || [];
  let ng = attacks.filter(a=>!best.includes(a));

  document.getElementById("bestBox").innerHTML =
    "◎ 最適（直近"+history.length+"回）<br>▶ "+best.join("<br>▶ ");

  document.getElementById("ngBox").innerHTML =
    "✕ NG<br>▶ "+ng.join("<br>▶ ");
}

function recordOutcome(success){
  if(!success){
    failStreak++;
    if(failStreak>=2){
      document.getElementById("warning").innerHTML=
      "⚠ 三大択が機能していません<br>遅らせグラの可能性<br>▶ 遅らせ打撃を検討";
    }
  }else{
    failStreak=0;
    document.getElementById("warning").innerHTML="";
  }
}

function resetAll(){
  history=[];
  failStreak=0;
  localStorage.removeItem("history");
  document.getElementById("bestBox").innerHTML="";
  document.getElementById("ngBox").innerHTML="";
  document.getElementById("warning").innerHTML="";
}

updateRecommendation();

</script>

</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>密着起き攻め 偏り検出</title>

<style>
body{
  margin:0;
  background:#0f0f0f;
  color:white;
  font-family:sans-serif;
  text-align:center;
}

h1{
  font-size:20px;
  margin:10px 0;
}

.section{
  margin:15px 0;
}

button{
  width:45%;
  padding:18px;
  margin:5px;
  font-size:18px;
  border-radius:12px;
  border:none;
}

.def-btn{background:#2c2c2c;color:white;}
.result-btn{background:#444;color:white;}
.success{background:#2e7d32;}
.fail{background:#c62828;}

.box{
  margin:10px;
  padding:10px;
  border-radius:10px;
}

.best{background:#1b5e20;}
.second{background:#0d47a1;}
.ng{background:#4e342e;}

.warning{
  color:#ff5252;
  font-weight:bold;
  margin-top:10px;
}

.reset{
  background:#555;
  margin-top:10px;
}
</style>
</head>

<body>

<h1>密着起き攻め 偏り検出</h1>

<div class="section" id="defenseButtons"></div>

<div class="section">
  <button class="result-btn success" onclick="recordOutcome(true)">通った</button>
  <button class="result-btn fail" onclick="recordOutcome(false)">通らなかった</button>
</div>

<div class="section">
  <div id="bestBox" class="box best"></div>
  <div id="secondBox" class="box second"></div>
  <div id="ngBox" class="box ng"></div>
</div>

<div id="warning" class="warning"></div>

<button class="reset" onclick="resetAll()">リセット</button>

<script>

const defenses = [
"ガード","投げ抜け","暴れ","無敵技",
"バクステ","ジャンプ","パリィ","ドライブリバーサル"
];

const attacks = ["打撃","投げ","シミー"];

let counts = {};
let failStreak = 0;

defenses.forEach(d => counts[d]=0);

const winMap = {
"ガード": ["投げ"],
"投げ抜け": ["シミー"],
"暴れ": ["打撃","投げ"],
"バクステ": ["打撃"],
"ジャンプ": ["打撃"],
"無敵技": ["シミー"],
"パリィ": ["投げ","シミー"],
"ドライブリバーサル": ["シミー"]
};

const defenseContainer = document.getElementById("defenseButtons");

defenses.forEach(def=>{
  const btn=document.createElement("button");
  btn.innerText=def;
  btn.className="def-btn";
  btn.onclick=()=>{
    counts[def]++;
    updateRecommendation();
  };
  defenseContainer.appendChild(btn);
});

function updateRecommendation(){

  let maxDefense = Object.keys(counts).reduce((a,b)=>
    counts[a] > counts[b] ? a : b
  );

  let best = winMap[maxDefense] || [];

  let second = attacks.filter(a=>!best.includes(a));
  let ng = [];

  // NGは完全に負ける択のみ表示
  ng = attacks.filter(a=>{
    return !best.includes(a);
  });

  document.getElementById("bestBox").innerHTML =
    best.length ? "◎ 最適<br>▶ "+best.join("<br>▶ ") : "";

  document.getElementById("secondBox").innerHTML =
    second.length ? "○ 次点<br>▶ "+second.join("<br>▶ ") : "";

  document.getElementById("ngBox").innerHTML =
    ng.length ? "✕ NG<br>▶ "+ng.join("<br>▶ ") : "";
}

function recordOutcome(success){
  if(!success){
    failStreak++;
    if(failStreak>=2){
      document.getElementById("warning").innerHTML=
      "⚠ 三大択が機能していません<br>遅らせグラの可能性<br>▶ 遅らせ打撃を検討";
    }
  }else{
    failStreak=0;
    document.getElementById("warning").innerHTML="";
  }
}

function resetAll(){
  defenses.forEach(d=>counts[d]=0);
  failStreak=0;
  document.getElementById("bestBox").innerHTML="";
  document.getElementById("secondBox").innerHTML="";
  document.getElementById("ngBox").innerHTML="";
  document.getElementById("warning").innerHTML="";
}

</script>

</body>
</html>
